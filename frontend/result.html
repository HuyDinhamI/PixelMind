<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫øt qu·∫£ - PixelMind</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="result-screen">
            <div class="header">
                <h2>üéâ K·∫øt qu·∫£</h2>
            </div>
            
            <div class="result-content">
                <div class="comparison-container">
                    <div class="image-comparison">
                        <div class="before-after">
                            <div class="image-box">
                                <h3>·∫¢nh g·ªëc</h3>
                                <img id="originalImage" src="" alt="Original photo">
                            </div>
                            
                            <div class="arrow">‚Üí</div>
                            
                            <div class="image-box">
                                <h3>·∫¢nh ƒë√£ ch·ªânh s·ª≠a</h3>
                                <img id="generatedImage" src="" alt="Generated photo">
                                <div class="image-overlay">
                                    <button class="download-btn" onclick="downloadImage()">
                                        ‚¨áÔ∏è T·∫£i xu·ªëng
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="result-info">
                    <div class="prompt-used">
                        <h4>Y√™u c·∫ßu ch·ªânh s·ª≠a:</h4>
                        <p id="promptText"></p>
                    </div>
                    
                    <div class="result-actions">
                        <button class="secondary-btn" onclick="startOver()">
                            üì∏ Ch·ª•p ·∫£nh m·ªõi
                        </button>
                        <button class="primary-btn" onclick="editAgain()">
                            ‚ú® Ch·ªânh s·ª≠a l·∫°i
                        </button>
                    </div>
                </div>
                
                <div class="tips">
                    <h4>üí° M·∫πo:</h4>
                    <ul>
                        <li>B·∫°n c√≥ th·ªÉ ch·ª•p ·∫£nh m·ªõi ƒë·ªÉ th·ª≠ nghi·ªám v·ªõi c√°c ƒë·ªëi t∆∞·ª£ng kh√°c</li>
                        <li>Th·ª≠ c√°c m√¥ t·∫£ ch·ªânh s·ª≠a kh√°c nhau ƒë·ªÉ c√≥ k·∫øt qu·∫£ ƒëa d·∫°ng</li>
                        <li>M√¥ t·∫£ c√†ng chi ti·∫øt th√¨ k·∫øt qu·∫£ AI c√†ng ch√≠nh x√°c</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        let currentResult = null;
        
        // Load result when page loads
        window.addEventListener('load', function() {
            const resultData = localStorage.getItem('processResult');
            if (!resultData) {
                alert('Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£. Vui l√≤ng th·ª±c hi·ªán l·∫°i.');
                window.location.href = 'index.html';
                return;
            }
            
            try {
                currentResult = JSON.parse(resultData);
                loadResult();
            } catch (error) {
                console.error('Error parsing result data:', error);
                alert('L·ªói d·ªØ li·ªáu k·∫øt qu·∫£. Vui l√≤ng th·ª±c hi·ªán l·∫°i.');
                window.location.href = 'index.html';
            }
        });
        
        function loadResult() {
            if (!currentResult) return;
            
            // Load original image from localStorage
            const capturedImageData = localStorage.getItem('capturedImage');
            if (capturedImageData) {
                document.getElementById('originalImage').src = capturedImageData;
            }
            
            // Load generated image from backend
            const backendUrl = 'http://localhost:5000';
            document.getElementById('generatedImage').src = backendUrl + currentResult.generated_image;
            
            // Show prompt if available
            const promptText = localStorage.getItem('lastPrompt') || 'Kh√¥ng c√≥ th√¥ng tin';
            document.getElementById('promptText').textContent = promptText;
        }
        
        function downloadImage() {
            if (!currentResult) return;
            
            const backendUrl = 'http://localhost:5000';
            const downloadUrl = backendUrl + '/api/download/' + currentResult.generated_filename;
            
            // Create temporary link for download
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = 'pixelmind_edited_image.jpg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function startOver() {
            // Clear all stored data
            localStorage.removeItem('capturedImage');
            localStorage.removeItem('processResult');
            localStorage.removeItem('lastPrompt');
            
            // Go back to start
            window.location.href = 'index.html';
        }
        
        function editAgain() {
            // Keep the captured image, just go back to edit
            window.location.href = 'edit.html';
        }
    </script>
</body>
</html>
